name: "$(date:yyyyMMdd)$(Build.BuildId)"

trigger:
- master

pool:
  name: default
  demands:
  - agent.name -equals MacBook-Pro-di-Jonathan

stages:
- stage: Testing 
  displayName: "Test di versione"
  jobs:   
    - job: Test             
      steps:
        - script: npm install
          displayName: 'Installa dipendenze'        
        - script: npm run test-ci
          displayName: 'Esegui test' 
      displayName: "Test versione"
    - job: Build   
      dependsOn: Test 
- stage: Deploy
  dependsOn: Testing
  condition: succeeded()
  displayName: "Deploy versione"  
  jobs:    
    - deployment: 
      displayName: "Distribuzione versione"
      environment: Production
      strategy:
        runOnce:
          deploy:
            steps:              
              - script: npm install
                displayName: 'Installa dipendenze'        
              - script: npm run build
                displayName: 'Compila'              
              - task: PublishPipelineArtifact@1
                inputs:
                  targetPath: '$(Build.SourcesDirectory)/dist/frontend-angular/browser/'
                  publishLocation: 'pipeline'
                displayName: "Pubblica artefatto"        
          

